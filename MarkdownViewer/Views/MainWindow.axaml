<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:md="clr-namespace:LiveMarkdown.Avalonia;assembly=LiveMarkdown.Avalonia"
        xmlns:views="clr-namespace:MarkdownViewer.Views"
        xmlns:services="clr-namespace:MarkdownViewer.Services"
        xmlns:models="clr-namespace:MarkdownViewer.Models"
        x:Class="MarkdownViewer.Views.MainWindow"
        Title="lucidVIEW"
        Width="1100" Height="750"
        MinWidth="600" MinHeight="450"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource AppBackground}">

    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenFileCommand}" />
        <KeyBinding Gesture="Ctrl+Shift+O" Command="{Binding OpenUrlCommand}" />
        <KeyBinding Gesture="F11" Command="{Binding ToggleFullScreenCommand}" />
        <KeyBinding Gesture="Ctrl+B" Command="{Binding ToggleSidePanelCommand}" />
        <KeyBinding Gesture="Ctrl+F" Command="{Binding ToggleSearchCommand}" />
        <KeyBinding Gesture="Escape" Command="{Binding EscapeCommand}" />
        <KeyBinding Gesture="Ctrl+Add" Command="{Binding FontSizeIncreaseCommand}" />
        <KeyBinding Gesture="Ctrl+Subtract" Command="{Binding FontSizeDecreaseCommand}" />
        <KeyBinding Gesture="Ctrl+P" Command="{Binding PrintCommand}" />
        <KeyBinding Gesture="F1" Command="{Binding OpenHelpCommand}" />
    </Window.KeyBindings>

    <Grid>
        <!-- Main Layout -->
        <DockPanel>
            <!-- Clean Header Bar -->
            <Border DockPanel.Dock="Top" Classes="header-bar">
                <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto,Auto">
                    <!-- Left: Hamburger Menu -->
                    <Button Grid.Column="0"
                            Classes="header-btn"
                            Click="OnToggleSidePanel"
                            ToolTip.Tip="Menu (Ctrl+B)">
                        <PathIcon Data="M2,4 L22,4 L22,6 L2,6 Z M2,11 L22,11 L22,13 L2,13 Z M2,18 L22,18 L22,20 L2,20 Z"
                                  Width="18" Height="18"
                                  Foreground="{DynamicResource AppText}" />
                    </Button>

                    <!-- TOC Button -->
                    <Button x:Name="TocButton"
                            Grid.Column="1"
                            Classes="header-btn"
                            Click="OnToggleToc"
                            ToolTip.Tip="Table of Contents">
                        <PathIcon Data="M3,4 L10,4 L10,6 L3,6 Z M3,9 L21,9 L21,11 L3,11 Z M3,14 L14,14 L14,16 L3,16 Z M3,19 L21,19 L21,21 L3,21 Z"
                                  Width="18" Height="18"
                                  Foreground="{DynamicResource AppText}" />
                    </Button>

                    <!-- Center: Zoom Controls -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="6">
                        <ToggleButton x:Name="FitWidthToggle"
                                      Classes="header-btn"
                                      IsChecked="True"
                                      Click="OnFitModeToggle"
                                      ToolTip.Tip="Fit to width">
                            <PathIcon Data="M4 12h16M4 12l3-3M4 12l3 3M20 12l-3-3M20 12l-3 3"
                                      Width="16" Height="16"
                                      Foreground="{DynamicResource AppText}" />
                        </ToggleButton>
                        <ToggleButton x:Name="FitHeightToggle"
                                      Classes="header-btn"
                                      IsChecked="False"
                                      Click="OnFitModeToggle"
                                      ToolTip.Tip="Fit to height">
                            <PathIcon Data="M12 4v16M12 4l-3 3M12 4l3 3M12 20l-3-3M12 20l3-3"
                                      Width="16" Height="16"
                                      Foreground="{DynamicResource AppText}" />
                        </ToggleButton>
                        <Slider x:Name="ZoomSlider"
                                Width="100"
                                Minimum="50"
                                Maximum="200"
                                Value="100"
                                TickFrequency="10"
                                IsSnapToTickEnabled="True"
                                VerticalAlignment="Center"
                                ValueChanged="OnZoomSliderChanged" />
                        <TextBlock x:Name="ZoomPercentText"
                                   Text="100%"
                                   Width="36"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource AppTextSecondary}"
                                   FontSize="12" />
                        <Button Classes="header-btn" Click="OnResetZoom" ToolTip.Tip="Reset zoom (1:1)">
                            <TextBlock Text="1:1" FontSize="11" FontWeight="Bold" Foreground="{DynamicResource AppText}" />
                        </Button>
                    </StackPanel>

                    <!-- Preview/Raw Toggle -->
                    <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="0" Margin="8,0">
                        <RadioButton x:Name="PreviewTab"
                                     Content="Preview"
                                     GroupName="ViewTabs"
                                     IsChecked="True"
                                     Click="OnTabChanged"
                                     Classes="header-tab" />
                        <RadioButton x:Name="RawTab"
                                     Content="Raw"
                                     GroupName="ViewTabs"
                                     Click="OnTabChanged"
                                     Classes="header-tab" />
                    </StackPanel>

                    <!-- Search Button -->
                    <Button Grid.Column="4"
                            Classes="header-btn"
                            Click="OnToggleSearch"
                            ToolTip.Tip="Search (Ctrl+F)">
                        <PathIcon Data="M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource AppText}" />
                    </Button>

                    <!-- Right: Font Size Controls -->
                    <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="0">
                        <Button x:Name="FontDecreaseBtn"
                                Classes="header-btn font-btn-small"
                                Click="OnFontSizeDecrease"
                                IsEnabled="False"
                                ToolTip.Tip="Decrease font size (Ctrl+-)">
                            <TextBlock Text="A" FontSize="13" FontWeight="Medium" Foreground="{DynamicResource AppText}" />
                        </Button>
                        <Button x:Name="FontIncreaseBtn"
                                Classes="header-btn font-btn-large"
                                Click="OnFontSizeIncrease"
                                IsEnabled="False"
                                ToolTip.Tip="Increase font size (Ctrl++)">
                            <TextBlock Text="A" FontSize="18" FontWeight="Medium" Foreground="{DynamicResource AppText}" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Status Bar -->
            <Border DockPanel.Dock="Bottom" Classes="status-panel">
                <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto">
                    <TextBlock x:Name="StatusText" Text="Ready" Classes="status-text" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" />
                    <TextBlock Grid.Column="1" x:Name="FileDateText" Classes="status-text" Margin="16,0" VerticalAlignment="Center" />
                    <TextBlock Grid.Column="2" x:Name="WordCountText" Classes="status-text" Margin="16,0" VerticalAlignment="Center" />
                    <TextBlock Grid.Column="3" x:Name="FileInfoText" Classes="status-text" Margin="16,0" VerticalAlignment="Center" />
                    <TextBlock Grid.Column="4" x:Name="FontSizeText" Text="16px" Classes="status-text" VerticalAlignment="Center" Margin="16,0,0,0" />
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <Grid>
                <!-- Drop Overlay -->
                <Border x:Name="DropOverlay" IsVisible="False" Classes="drop-overlay" ZIndex="100">
                    <Border Classes="drop-card" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <StackPanel Spacing="16" HorizontalAlignment="Center">
                            <PathIcon Data="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"
                                      Width="48" Height="48"
                                      Foreground="{DynamicResource AppAccent}" />
                            <TextBlock Text="Drop markdown file here"
                                       FontSize="16"
                                       Foreground="{DynamicResource AppText}"
                                       HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </Border>

                <!-- Welcome Panel -->
                <Border x:Name="WelcomePanel" IsVisible="True" Background="{DynamicResource AppBackground}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                        <TextBlock Text="Welcome to" Classes="welcome-subtitle" HorizontalAlignment="Center" />
                        <!-- lucidVIEW Logo -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="lucid"
                                       FontSize="48"
                                       FontWeight="SemiBold"
                                       FontStyle="Italic"
                                       FontFamily="Raleway, Segoe UI, sans-serif"
                                       Foreground="{DynamicResource BrandLucid}" />
                            <TextBlock Text="VIEW"
                                       FontSize="48"
                                       FontWeight="Bold"
                                       FontFamily="Raleway, Segoe UI, sans-serif"
                                       Foreground="{DynamicResource BrandVIEW}" />
                        </StackPanel>
                        <!-- mostlylucid Logo (styled as text) -->
                        <Button Classes="link-btn" Click="OnMostlyLucidClick" Cursor="Hand" HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="by " FontSize="14" Foreground="{DynamicResource AppTextSecondary}" VerticalAlignment="Center" />
                                <TextBlock Text="mostly"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           FontFamily="Raleway, Segoe UI, sans-serif"
                                           Foreground="{DynamicResource BrandLucid}"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="lucid"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           FontFamily="Raleway, Segoe UI, sans-serif"
                                           Foreground="{DynamicResource BrandVIEW}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                        <TextBlock Text="Open a file or drag and drop to get started"
                                   Classes="welcome-subtitle"
                                   HorizontalAlignment="Center"
                                   Margin="0,8,0,16" />
                        <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
                            <Button Content="Open File"
                                    Classes="welcome-btn-primary"
                                    Command="{Binding OpenFileCommand}" />
                            <Button Content="Open URL"
                                    Classes="welcome-btn"
                                    Command="{Binding OpenUrlCommand}" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Content Area -->
                <Grid x:Name="ContentGrid" IsVisible="False">
                    <DockPanel>
                        <!-- TOC Panel - docked left, non-modal -->
                        <Border x:Name="TocPanel"
                                DockPanel.Dock="Left"
                                IsVisible="False"
                                Width="250"
                                Background="{DynamicResource AppBackgroundSecondary}"
                                BorderBrush="{DynamicResource AppBorder}"
                                BorderThickness="0,0,1,0">
                            <DockPanel>
                                <!-- TOC Header -->
                                <Border DockPanel.Dock="Top" Classes="panel-header">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0"
                                                   Text="Contents"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Foreground="{DynamicResource AppText}"
                                                   VerticalAlignment="Center"
                                                   Margin="12,0,0,0" />
                                        <Button Grid.Column="1"
                                                Classes="header-btn"
                                                Click="OnCloseToc"
                                                ToolTip.Tip="Close TOC">
                                            <PathIcon Data="M18 6L6 18M6 6l12 12" Width="14" Height="14" Foreground="{DynamicResource AppText}" />
                                        </Button>
                                    </Grid>
                                </Border>

                                <!-- TOC Content -->
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox x:Name="TocItemsControl"
                                             Margin="4"
                                             Background="Transparent"
                                             SelectionChanged="OnTocSelectionChanged">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Text}"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="{Binding Margin}"
                                                           Foreground="{DynamicResource AppText}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </DockPanel>
                        </Border>

                        <!-- Search Bar -->
                        <Border x:Name="SearchPanel"
                                DockPanel.Dock="Top"
                                IsVisible="False"
                                Background="{DynamicResource AppBackgroundSecondary}"
                                BorderBrush="{DynamicResource AppBorder}"
                                BorderThickness="0,0,0,1"
                                Padding="12,8">
                            <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto">
                                <TextBox x:Name="SearchBox"
                                         Watermark="Search... (Enter to find, Esc to close)"
                                         KeyDown="OnSearchKeyDown" />
                                <Button Grid.Column="1"
                                        Classes="toolbar"
                                        Content="Prev"
                                        ToolTip.Tip="Previous match (Shift+Enter)"
                                        Click="OnSearchPrevious"
                                        Margin="8,0,0,0" />
                                <Button Grid.Column="2"
                                        Classes="toolbar"
                                        Content="Next"
                                        ToolTip.Tip="Next match (Enter)"
                                        Click="OnSearchNext"
                                        Margin="4,0,0,0" />
                                <TextBlock Grid.Column="3"
                                           x:Name="SearchResultsText"
                                           VerticalAlignment="Center"
                                           Foreground="{DynamicResource AppTextSecondary}"
                                           FontSize="12"
                                           Margin="12,0,0,0" />
                                <Button Grid.Column="4"
                                        Classes="toolbar"
                                        Content="X"
                                        ToolTip.Tip="Close search (Esc)"
                                        Click="OnCloseSearch"
                                        Margin="8,0,0,0" />
                            </Grid>
                        </Border>

                        <!-- Metadata Panel (categories, date) -->
                        <Border x:Name="MetadataPanel" DockPanel.Dock="Top" Classes="metadata-panel" IsVisible="False">
                            <Grid ColumnDefinitions="*,Auto">
                                <!-- Categories as tags -->
                                <ItemsControl x:Name="CategoriesControl" Grid.Column="0">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Classes="category-tag">
                                                <TextBlock Text="{Binding}" Classes="category-text" />
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- Publication date -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock x:Name="MetadataDateLabel" Text="Published:" Classes="metadata-label" IsVisible="False" />
                                    <TextBlock x:Name="MetadataDateText" Classes="metadata-date" />
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Content Views - stacked, only one visible at a time -->
                        <Grid>
                            <!-- Rendered Markdown - DockPanel for fixed gutters at edges -->
                            <DockPanel x:Name="RenderedPanel" IsVisible="True" Background="{DynamicResource AppBackground}">
                                <!-- Left gutter (docked to left edge of window) -->
                                <Border DockPanel.Dock="Left" Width="18" Background="{DynamicResource AppBackgroundSecondary}" />

                                <!-- ScrollViewer fills remaining space, its scrollbar naturally at right edge -->
                                <ScrollViewer x:Name="RenderedScroller"
                                              HorizontalScrollBarVisibility="Disabled"
                                              VerticalScrollBarVisibility="Visible"
                                              AllowAutoHide="False">
                                    <LayoutTransformControl x:Name="MarkdownLayoutTransform">
                                        <Border Padding="40,32" MaxWidth="1200" HorizontalAlignment="Center">
                                            <md:MarkdownRenderer x:Name="MdViewer">
                                                <md:MarkdownRenderer.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="Copy" Click="OnCopyText" InputGesture="Ctrl+C">
                                                            <MenuItem.Icon>
                                                                <PathIcon Data="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                                                            </MenuItem.Icon>
                                                        </MenuItem>
                                                        <MenuItem Header="Select All" Click="OnSelectAll" InputGesture="Ctrl+A" />
                                                        <Separator />
                                                        <MenuItem Header="Copy as HTML" Click="OnCopyAsHtml" />
                                                    </ContextMenu>
                                                </md:MarkdownRenderer.ContextMenu>
                                            </md:MarkdownRenderer>
                                        </Border>
                                    </LayoutTransformControl>
                                </ScrollViewer>
                            </DockPanel>

                            <!-- Raw Markdown -->
                            <ScrollViewer x:Name="RawScroller"
                                          IsVisible="False"
                                          HorizontalScrollBarVisibility="Auto"
                                          VerticalScrollBarVisibility="Auto"
                                          Background="{DynamicResource AppBackground}">
                                <Border Padding="24,16">
                                    <SelectableTextBlock x:Name="RawTextBlock"
                                                         FontFamily="Cascadia Code, JetBrains Mono, Consolas, monospace"
                                                         FontSize="13"
                                                         Foreground="{DynamicResource AppText}"
                                                         TextWrapping="NoWrap" />
                                </Border>
                            </ScrollViewer>
                        </Grid>
                    </DockPanel>
                </Grid>
            </Grid>
        </DockPanel>

        <!-- Side Panel Overlay (click to close) -->
        <Border x:Name="SidePanelOverlay"
                IsVisible="False"
                Background="{DynamicResource PanelOverlay}"
                ZIndex="200"
                PointerPressed="OnOverlayClick" />

        <!-- Slide-Out Side Panel -->
        <Border x:Name="SidePanel"
                IsVisible="False"
                Width="300"
                HorizontalAlignment="Left"
                Background="{DynamicResource AppBackgroundSecondary}"
                BorderBrush="{DynamicResource AppBorder}"
                BorderThickness="0,0,1,0"
                ZIndex="300">
            <DockPanel>
                <!-- Panel Header -->
                <Border DockPanel.Dock="Top" Classes="panel-header">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Button Grid.Column="0"
                                Classes="header-btn"
                                Click="OnCloseSidePanel"
                                ToolTip.Tip="Close menu">
                            <PathIcon Data="M19 12H5M12 19l-7-7 7-7" Width="18" Height="18" />
                        </Button>
                        <StackPanel Grid.Column="1"
                                   Orientation="Horizontal"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0">
                            <TextBlock Text="lucid"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       FontStyle="Italic"
                                       FontFamily="Raleway, Segoe UI, San Francisco, Ubuntu"
                                       Foreground="{DynamicResource BrandLucid}" />
                            <TextBlock Text="VIEW"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       FontFamily="Raleway, Segoe UI, San Francisco, Ubuntu"
                                       Foreground="{DynamicResource BrandVIEW}" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Panel Content -->
                <ScrollViewer>
                    <StackPanel Margin="0,8,0,16">
                        <!-- Open File -->
                        <Button Classes="panel-item" Click="OnOpenFile">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PathIcon Data="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6"
                                          Width="20" Height="20" />
                                <TextBlock Text="Open file..." VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <!-- Open URL -->
                        <Button Classes="panel-item" Click="OnOpenUrl">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PathIcon Data="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71 M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                                          Width="20" Height="20" />
                                <TextBlock Text="Open URL..." VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Border Classes="panel-separator" />

                        <!-- Recent Files -->
                        <Expander Classes="panel-expander" IsExpanded="True">
                            <Expander.Header>
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <PathIcon Data="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"
                                              Width="20" Height="20" />
                                    <TextBlock Text="Recent Files" VerticalAlignment="Center" />
                                </StackPanel>
                            </Expander.Header>
                            <ItemsControl x:Name="RecentFilesList" Margin="32,4,8,4">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="models:RecentFile">
                                        <Button Classes="panel-subitem"
                                                Content="{Binding DisplayName}"
                                                Tag="{Binding Path}"
                                                Click="OnRecentFileClick" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Expander>

                        <Border Classes="panel-separator" />

                        <!-- Theme -->
                        <Expander Classes="panel-expander" IsExpanded="True">
                            <Expander.Header>
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <PathIcon Data="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"
                                              Width="20" Height="20" />
                                    <TextBlock Text="Theme" VerticalAlignment="Center" />
                                </StackPanel>
                            </Expander.Header>
                            <UniformGrid Columns="2" Margin="0" HorizontalAlignment="Stretch">
                                <Button x:Name="ThemeLightCard" Classes="theme-card" Tag="Light" Click="OnThemeCardClick">
                                    <StackPanel Spacing="4">
                                        <Border Classes="theme-preview theme-preview-light">
                                            <TextBlock Text="A" FontSize="24" FontWeight="Medium"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Foreground="#1a1a1a" />
                                        </Border>
                                        <TextBlock Text="Light" HorizontalAlignment="Center" FontSize="12" />
                                    </StackPanel>
                                </Button>
                                <Button x:Name="ThemeDarkCard" Classes="theme-card" Tag="Dark" Click="OnThemeCardClick">
                                    <StackPanel Spacing="4">
                                        <Border Classes="theme-preview theme-preview-dark">
                                            <TextBlock Text="A" FontSize="24" FontWeight="Medium"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Foreground="#e6edf3" />
                                        </Border>
                                        <TextBlock Text="Dark" HorizontalAlignment="Center" FontSize="12" />
                                    </StackPanel>
                                </Button>
                                <Button x:Name="ThemeVSCodeCard" Classes="theme-card" Tag="VSCode" Click="OnThemeCardClick">
                                    <StackPanel Spacing="4">
                                        <Border Classes="theme-preview theme-preview-vscode">
                                            <TextBlock Text="A" FontSize="24" FontWeight="Medium"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Foreground="#d4d4d4" />
                                        </Border>
                                        <TextBlock Text="VS Code" HorizontalAlignment="Center" FontSize="12" />
                                    </StackPanel>
                                </Button>
                                <Button x:Name="ThemeGitHubCard" Classes="theme-card" Tag="GitHub" Click="OnThemeCardClick">
                                    <StackPanel Spacing="4">
                                        <Border Classes="theme-preview theme-preview-github">
                                            <TextBlock Text="A" FontSize="24" FontWeight="Medium"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Foreground="#e6edf3" />
                                        </Border>
                                        <TextBlock Text="GitHub" HorizontalAlignment="Center" FontSize="12" />
                                    </StackPanel>
                                </Button>
                            </UniformGrid>
                        </Expander>

                        <Border Classes="panel-separator" />

                        <!-- Contents (TOC) -->
                        <Expander x:Name="ContentsExpander" Classes="panel-expander" IsExpanded="True">
                            <Expander.Header>
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <PathIcon Data="M4 6h16M4 12h10M4 18h16" Width="20" Height="20" />
                                    <TextBlock Text="Contents" VerticalAlignment="Center" />
                                </StackPanel>
                            </Expander.Header>
                            <ItemsControl x:Name="NavTreeView" Margin="8,4,8,4">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="services:HeadingItem">
                                        <Button Classes="panel-subitem"
                                                HorizontalAlignment="Stretch"
                                                HorizontalContentAlignment="Left"
                                                Padding="{Binding ItemPadding}"
                                                Click="OnHeadingClick">
                                            <TextBlock Text="{Binding Text}"
                                                       TextTrimming="CharacterEllipsis" />
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Expander>

                        <Border Classes="panel-separator" />

                        <!-- Print -->
                        <Button Classes="panel-item" Click="OnPrint">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PathIcon Data="M6 9V2h12v7 M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2 M6 14h12v8H6z"
                                          Width="20" Height="20" />
                                <TextBlock Text="Print..." VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <!-- Search -->
                        <Button Classes="panel-item" Click="OnToggleSearch">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PathIcon Data="M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"
                                          Width="20" Height="20" />
                                <TextBlock Text="Search (Ctrl+F)" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Border Classes="panel-separator" />

                        <!-- Settings -->
                        <Button Classes="panel-item" Click="OnOpenSettings">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PathIcon Data="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                                          Width="20" Height="20" />
                                <TextBlock Text="Settings" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <!-- Help -->
                        <Button Classes="panel-item" Click="OnOpenHelp">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PathIcon Data="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3 M12 17h.01"
                                          Width="20" Height="20" />
                                <TextBlock Text="Help (F1)" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- TOC Panel - hidden for overlay mode, actual TOC is inline in content area -->
    </Grid>
</Window>
